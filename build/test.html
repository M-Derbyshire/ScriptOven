<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="utf-8">
		<title>
			<!--NEED TO FILL THIS IN!!!-->
			Title Here
		</title>
		<style>
			body {
	background: #20002c;
	color: #c2c503;
	font-family: Arial, Helvetica, sans-serif;
}

a {
	color: #009191;
}

a:hover {
	color: #007979;
}

header, main, footer {
	border: 1px solid #989b04;
	border-radius: 0.5em;
	margin: 0.5em auto;
	padding: 0.5em;
}

footer p {
	margin: 0.5em auto;
	font-size: larger;
}

#profileLinksList {
	list-style-type: none;
	padding-left: 0.5em;
	margin: 0.5em auto;
}

main label {
	font-weight: bold;
}

main div {
	margin: 0.25em auto;
}

/* Overwrite the above for 1st level of divs */
main > div {
	margin: 1em auto;
	border: 1px solid #5a5c04;
	border-radius: 0.5em;
	padding: 0.5em 1em;
}

main > div > h2 {
	margin: 0.75em auto;
}

main textarea {
	width: 100%;
	height: 20em;
	margin: 0.5em 0;
	resize: none;
	background: #66008b;
	border: 1px solid #5a5c04;
	color: #b8b802;
}

main textarea:focus {
	outline: none;
}

#runButtonSection {
	padding: 1em;
	background: #01294b;
}

#runButtonSection button {
	font-size: x-large;
}


		</style>
		<script id="standardScripts">
			//Defines the way that general errors will be handled
function handleError(errorText)
{
	alert("Error: " + errorText);
}

//Tests that the script text contains a main function, and it has
//the correct amount of parameters
function mainFunctionDefinitionIsCorrect(scriptText)
{
	return /main\([^,]*\)/.test(scriptText);
}

//Populates the dynamicScript element with the given script text
function populateDynamicScript(scriptText)
{
	const dynamicScript = document.getElementById("dynamicScript");
	
	try 
	{
		dynamicScript.text = scriptText;
	}
	catch(err)
	{
		handleError(err);
	}
}

// Will run when the Run Function button is clicked
function runButtonOnClick()
{
	const scriptFileInput = document.getElementById("scriptFileInput");
	const inTextInput = document.getElementById("inTextInput");
	const outTextOutput = document.getElementById("outTextOuput");
	
	if(scriptFileInput.files.length === 0)
	{
		handleError("No script has been selected.");
		return;
	}
	
	//Get the file text and start the process
	const fileReader = new FileReader();
	fileReader.addEventListener('load', (event) => {
		try
		{
			runFunctionOnInputText(event.target.result);
		}
		catch(err)
		{
			handleError(err);
		}
	});
	fileReader.readAsText(scriptFileInput.files[0]);
}

//Called by the FileReader callback (in runButtonOnClick()). Takes the 
//text from the script file.
function runFunctionOnInputText(functionText)
{
	//Does the given script text contain a "main" function that takes only 1 parameter?
	if(!mainFunctionDefinitionIsCorrect(functionText))
	{
		handleError('The uploaded script does not contain a "main" function (or the given function does not accept only 1 parameter).');
		return;
	}
	
	const inTextInput = document.getElementById("inTextInput");
	const outTextOuput = document.getElementById("outTextOuput");
	
	populateDynamicScript(functionText);
	const resultText = main(inTextInput.value);
	
	//normal equality, so will also catch undefined
	if(resultText == null)
	{
		handleError('The given "main" function ran, but it did not return a valid value.');
		return;
	}
	
	outTextOuput.value = resultText;
}


		</script>
		
		<script id="dynamicScript"></script>
	</head>
	<body>
		
		<header>
			<h1>I'll think of a name later</h1>
		</header>
		
		<main>
			<div id="scriptUploadSection">
				<label for="scriptFileInput">Script file to use: </label>
				<input type="file" id="scriptFileInput" />
			</div>
			
			<div id="inTextSection">
				<h2>Function Input</h2>
				<textarea id="inTextInput" wrap="off">Enter the text to be passed to the function here (Or upload a file with the button below).</textarea>
				<div id="inTextFileUploadSection">
					<input type="file" id="inTextFileInput" />
				</div>
			</div>
			
			<div id="runButtonSection">
				<button onclick="runButtonOnClick()">Run Function</button>
			</div>
			
			<div id="outTextSection">
				<h2>Function Output</h2>
				<textarea id="outTextOuput" wrap="off">Results will be outputted here.</textarea>
				<div id="outTextDownloadSection">
					<button id="outTextDownloadButton">Download Output</button>
				</div>
			</div>	
		</main>
		
		<footer>
			<p>Developed by Matthew Derbyshire</p>
			<ul id="profileLinksList">
				<li><a id="twitterLink" target="_blank" href="https://twitter.com/mattdarbs">My Twitter</a></li>
				<li><a id="githubLink" target="_blank" href="https://github.com/M-Derbyshire">My GitHub</a></li>
			</ul>
		</footer>
	</body>
</html>